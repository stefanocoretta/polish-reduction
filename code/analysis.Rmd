---
title: "Distance vs. time. Acoustic and articulatory consequences of reduced vowel duration in Polish*"
#author: "Patrycja Strycharczuk, Małgorzata Ćavar, Stefano Coretta"
output: 
  rmdformats::downcute:
    toc_depth: 3
    number_sections: yes
    use_bookdown: yes
    fig_width: 7
    fig_height: 5
bibliography: "`r here::here('./references.bib')`"
cls: unified-style-sheet-for-linguistics.csl
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
knitr::opts_knit$set(root.dir = here::here())
library(usdm)
library(tidyverse)
library(rticulate)
library(printr)
library(ggpubr)
library(ggrepel)
library(patchwork)
library(lme4)
library(lmerTest)
library(optimx)
library(performance)
library(effects)
library(sjPlot)
library(emmeans)
theme_set(theme_bw(base_family = "Lato"))
options(
  ggplot2.discrete.fill = list(
    # 2 cols
    c("#264653", "#e76f51"),
    # 3 cols
    c("#B09B37", "#955F47", "#A8B9CB"),
    # 6 cols
    c("#7ACCD7", "#115896", "#7C6C65", "#4C4C53", "#BA2F00", "#21282F")
  )
)
```

# Overview

```{r prep-data}
midpoint_rotated <- readRDS("./data/derived/midpoint_rotated.rds") %>%
  mutate(
    rate = factor(rate, levels = c("slow", "normal", "fast")),
    stress = factor(stress, levels = c("unstressed", "stressed")),
    item = factor(item),
    V1 = str_replace(V1, "y", "ɨ"),
    V1 = factor(V1, levels = c("a", "e", "i", "o", "u", "ɨ")),
    frame = item,
    duration.log = log(duration),
    z1 = as.numeric(z1),
    z2 = as.numeric(z2),
    f1.z = as.numeric(f1.z),
    f2.z = as.numeric(f2.z),
    f0.z = as.numeric(f0.z)
  )

levels(midpoint_rotated$frame) <- c(
  "b_b", "b_b", "b_w", "b_w", "s_m", "drz_w", "drz_w",
  "k_m", "k_m", "m_m", "m_m", "ni_b", "ni_b", "n_w",
  "n_w", "p_p", "p_p", "p_p", "p_p", "rz_p", "rz_p", 
  "s_m", "z_m", "z_m", "z_w", "z_w"
)



midpoint_long <- readRDS("./data/derived/midpoint_long.rds") %>%
  mutate(
    rate = factor(rate, levels = c("fast", "normal", "slow")),
    stress = factor(stress, levels = c("unstressed", "stressed")),
    V1 = factor(V1, levels = c("a", "e", "i", "o", "u", "y")),
    V1 = recode_factor(V1, i = "i", e = "e", y = "ɨ", a = "a", o = "o", u = "u")
  )
```

This supplementary document complements the paper *Distance vs. time. Articulatory and acoustic consequences of reduced vowel duration in Polish*.

The following sections illustrate:

1. The data extracted from ultrasound images, and the formants.
2. Descriptive plots of the raw data.
3. Code and plots of the linear regression models.
4. Summaries of the models in 3.
5. Extra analyses of F0.

Only relevant R code is shown in this document.
The full code can be inspected on the OSF repository at <https://osf.io/hy7nt/?view_only=d06775a2cb1d4786a0442b0f15d73296>, in the file `code/analysis.Rmd`.

# Atriculatory data processing

This is Figure 1 from the paper, which illustrates the articulatory data processing, as well as vowel formants.
See paper for details.

```{r pl01}
PL01 <- midpoint_long %>%
  filter(
    speaker == "PL01" &
      fan_line >= 6 &
      fan_line <= 36
  ) %>%
  mutate(
    RateV1 = interaction(rate, V1, sep = "_"),
    StressV1 = interaction(stress, V1, sep = "_")
  ) 
```

```{r pl01-v, cache=TRUE}
pl01.gam <- polar_gam(
  Y ~
    V1 +
    s(X) +
    s(X, by = V1),
  data = PL01
)

PL01.smooths.plot <- predict_polar_gam(pl01.gam) %>%
  mutate(V1 = factor(V1, levels = c("a", "e", "i", "o", "u", "ɨ"))) %>%
  ggplot(aes(X, Y, colour = V1, linetype = V1)) +
  geom_path() +
  coord_fixed(ratio = 1) + 
  ggtitle("Tongue contours") +
  scale_x_reverse("Tongue backness (mm)") +
  scale_y_continuous("Tongue height (mm)") +
  theme(legend.title = element_blank())
```

```{r sum-pl01}
sum_PL01 <- midpoint_rotated %>%
  filter(speaker == "PL01") %>%
  group_by(V1) %>%
  summarize(
    f1.z = mean(f1.z),
    f2.z = mean(f2.z),
    PC1 = mean(PC1),
    PC2 = mean(PC2),
    z1 = mean(z1),
    z2 = mean(z2)
  )

PL01.PCA.plot <- sum_PL01 %>%
  mutate(V12 = factor(V1, levels = c("i", "e", "ɨ", "a", "o", "u"))) %>%
  arrange(V12) %>%
  ggplot() +
    aes(PC1, PC2, label = V1) +
    geom_polygon(color = "black", fill = NA, size = 0.25, linetype = "dashed") +
    geom_label(aes(fill = V1), colour = "white") +
    scale_x_reverse("PC1") +
    scale_y_reverse("PC2", limits = c(5.5, -4)) +
    coord_fixed() + 
    theme(
      legend.position = "none"
    ) +
    ggtitle("PCA results")

PL01.rot.plot <- sum_PL01 %>%
  mutate(V12 = factor(V1, levels = c("i", "e", "ɨ", "a", "o", "u"))) %>%
  arrange(V12) %>%
  ggplot() +
    aes(z2, z1, label = V1) +
    geom_polygon(color = "black", fill = NA, size = 0.25, linetype = "dashed") +
    geom_label(aes(fill = V1), colour = "white") +
    scale_x_reverse("z2") +
    scale_y_reverse("z1", limits = c(1, -1.25)) +
    coord_fixed() + 
    theme(legend.position = "none") +
    ggtitle("Predicted formants")

PL01.acc.plot <- sum_PL01 %>%
  mutate(V12 = factor(V1, levels = c("i", "e", "a", "o", "u", "ɨ"))) %>%
  arrange(V12) %>%
  ggplot() +
    aes(f2.z, f1.z, label = V1) +
    geom_polygon(color = "black", fill = NA, size = 0.25, linetype = "dashed") +
    geom_label(aes(fill = V1), colour = "white") +
    scale_x_reverse("F2.z", limits = c(2, -2)) +
    scale_y_reverse("F1.z", limits = c(2, -1.5)) +
    coord_fixed() + 
    theme(legend.position = "none") +
    ggtitle("Observed formants (normalised)")
```

```{r save-norm}
PL01.smooths.plot + PL01.PCA.plot + PL01.rot.plot + PL01.acc.plot

ggsave(file = "./figures/Figure1.pdf", width = 7, height = 5, device = cairo_pdf)
```


# Descriptive statistics plots

## Articulatory undershoot

Tongue contours from ultrasound tongue imaging of speaker PL01.
Tongue tip on the right.

```{r pl01-rate, cache=TRUE}
pl01_rate.gam <- polar_gam(
  Y ~
    RateV1 + 
    s(X) +
    s(X, by = RateV1),
  data = PL01
)

plot_polar_smooths(
  pl01_rate.gam,
  series = X,
  comparison = rate,
  facet_terms = V,
  split = list(RateV1 = c("rate", "V")),
  sep = "_"
) + 
  coord_fixed(ratio = 1) +
  scale_x_continuous("Tongue backness (mm)") +
  scale_y_continuous("Tongue height (mm)") +
  theme(legend.position = "top")
```

```{r pl01-stress, cache=TRUE}
pl01_stress.gam <- polar_gam(
  Y ~
    StressV1 +
    s(X) +
    s(X, by = StressV1),
  data = PL01
)

plot_polar_smooths(
  pl01_stress.gam,
  series = X,
  comparison = stress,
  facet_terms = V, 
  split = list(StressV1 = c("stress", "V")),
  sep = "_"
) + 
  coord_fixed(ratio = 1) +
  scale_x_continuous("Tongue backness (mm)") +
  scale_y_continuous("Tongue height (mm)") +
  theme(legend.position = "top")
```

## Duration

Figure 2 from the paper with boxplots and means of vowel duration depending on speech rate and stress.

```{r stress-rate}
dur.sum <- midpoint_rotated %>%
  select(rate, stress, duration) %>%
  group_by(rate, stress) %>%
  summarise(
    mean.dur = round(mean(duration),1),
    median.dur = round(median(duration),1),
    .groups = "drop"
  ) %>%
  mutate(rate = factor(rate, levels = c("slow", "normal", "fast")))

dur.stress.rate <- midpoint_rotated %>%
  mutate(rate = factor(rate, levels = c("slow", "normal", "fast"))) %>%
  ggboxplot(x = "stress", y = "duration") +
  scale_y_continuous('Vowel duration (ms)') +
  stat_summary(fun = mean, geom = "point", size = 1) +
  geom_text(data = dur.sum, aes(label = mean.dur, y = median.dur + 5), size = 3) +
  facet_wrap(~rate) +
  theme(axis.title.x = element_blank())
```

```{r save-rate-stress}
ggsave(dur.stress.rate, file = "./figures/Figure2.pdf", width = 6, height = 3, device = cairo_pdf)
```


## Vowel spaces


```{r acc}
acc.vowel.plot <- midpoint_rotated %>%
  group_by(V1, rate, stress) %>%
  summarise(mean.f1 = mean(f1.z, na.rm = T),
            mean.f2 = mean(f2.z, na.rm = T), .groups = "drop") %>%
  mutate(
    V1 = factor(V1, levels = c('i', 'e', 'a', 'o', 'u', 'ɨ')),
    rate = factor(rate, levels = c("slow", "normal", "fast")),
    stress = factor(stress, levels = c("stressed", "unstressed"))
  ) %>%
  arrange(stress, V1, rate)

levels(acc.vowel.plot$V1) = c('i', 'e', 'a', 'o', 'u', 'ɨ')

acc.plot <- acc.vowel.plot %>%
  ggplot() +
  aes(mean.f2, mean.f1, linetype = stress) +
  geom_polygon(color = 'grey5', fill = NA) +
  scale_x_reverse(limits = c(2, -1.5)) +
  scale_y_reverse(limits = c(2.5, -1.5)) +
  scale_fill_grey() +
  scale_shape_manual(values = c(15, 17, 19, 23, 8, 4)) +
  geom_point(aes(shape = V1, colour = V1), size = 4) +
  #coord_fixed()+
  theme(legend.position = "none") +
  labs(
    title = "(A) Observed vowel space",
    y = "Normalised F1 (z-scores)",
    x = "Normalised F2 (z-scores)"
  ) +
  facet_wrap( ~ rate) +
  theme(plot.margin = unit(c(0, 0, 0, 0), "lines"))
```


```{r pred_form}
z_sum <- midpoint_rotated %>%
  group_by(V1, rate, stress) %>%
  summarise(mean.comp1 = mean(z1, na.rm = T),
            mean.comp2 = mean(z2, na.rm = T), .groups = "drop") %>%
  mutate(
    V1 = factor(V1, levels = c('i', 'ɨ', 'e', 'a', 'o', 'u')),
    rate = factor(rate, levels = c("slow", "normal", "fast")),
    stress = factor(stress, levels = c('stressed', 'unstressed'))
  ) %>%
  arrange(rate, V1, stress)

levels(z_sum$V1) <- c("i", "ɨ", "e", "a", "o", "u")

z1z2.plot <- z_sum %>%
  ggplot() +
  aes(mean.comp2, mean.comp1, linetype = stress) +
  geom_polygon(color = 'grey5', fill = NA) +
  scale_x_reverse(limits = c(2, -1.5)) +
  scale_y_reverse(limits = c(1.5, -1.5)) +
  scale_fill_grey() +
  scale_shape_manual(values = c(15, 4, 17, 19, 23, 8)) +
  scale_colour_manual(values = c("#7ACCD7", "#21282F", "#115896", "#7C6C65", "#4C4C53", "#BA2F00")) +
  #coord_fixed()+
  geom_point(aes(shape = V1, colour = V1), size = 4) +
  theme(legend.position = "bottom",
        legend.title = element_blank()) +
  theme(plot.margin = unit(c(0, 0, 0, 0), "lines")) +
  labs(
    title = "(B) Predicted vowel space",
    y = "Predicted Z1 (z-scores)",
    x = "Prediced Z2 (z-scores)"
  ) +
  facet_wrap( ~ rate)
```


```{r save-acc-art}
acc.plot + z1z2.plot + plot_layout(ncol = 1)

ggsave(file = "./figures/Figure3.pdf", height = 6.5, width = 7, device = cairo_pdf)
```

# Inferential statistics

## VIF (multicollinearity)

VIF values below 3 indicate absence of multicollinearity [@zuur2010].
For all predictors, VIF < 3.

```{r vif}
midpoint_rotated %>%
  dplyr::select(duration, f1.z, f2.z, f0.z, rate, stress) %>%
  mutate(
    rate = as.numeric(rate) - 1.5,
    stress = as.numeric(stress) - 1
  ) %>%
  as.data.frame(.) %>%
  usdm::vif(.)
```

## Duration

```{r dur-lmer}
dur.lmer.full <- lmer(
  duration.log ~
    (rate+stress|speaker) +
    (1|frame) +
    rate*V1*stress,
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)
```

```{r ef-dur}
ef_dur_1 <- as.data.frame(effect("rate:stress", dur.lmer.full))
ef_dur <- as.data.frame(effect("rate:V1:stress", dur.lmer.full))

pd = position_dodge(width = 0.8)

ef_dur_1 <- ef_dur_1 %>%
  mutate(fit = exp(fit),
         lower = exp(lower),
         upper = exp(upper))

ef_dur <- ef_dur %>%
  mutate(fit = exp(fit),
         lower = exp(lower),
         upper = exp(upper))

dur_1 <- ef_dur_1 %>%
  ggplot() +
    aes(1, fit, color = stress, linetype = stress) +
    geom_point(position = pd) +
    geom_errorbar(aes(ymin = lower, ymax = upper), position = pd, width = 0, size = 0.5) +
    facet_wrap(~rate) +
    scale_x_discrete("Rate") +
    scale_y_continuous("Duration (ms)")

dur <- ef_dur %>%
  ggplot() +
    aes(V1, fit, color = stress, linetype = stress) +
    geom_point(position = pd) +
    geom_errorbar(aes(ymin = lower, ymax = upper), position = pd, width = 0, size = 0.5) +
    facet_wrap(~rate) +
    scale_x_discrete("Vowel") +
    scale_y_continuous("Vowel duration (ms)")

dur

ggsave(dur, file = "./figures/Figure4.pdf", width = 7, height = 4, device = cairo_pdf)
```

```{r dur-anova}
dur.lmer2 = lmer(
  duration.log ~ (rate + stress |
                    speaker) + (1 | frame) + rate * (V1 + stress),
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)

dur.lmer3 = lmer(
  duration.log ~ (rate + stress |
                    speaker) + (1 | frame) + rate * V1 + stress,
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)

anova(dur.lmer.full, dur.lmer2, dur.lmer3)
```

## F1

```{r f1-lmer}
f1.lmer.base <- lmer(
  f1.z ~
    (1|speaker) +
   (1|frame) +
    V1*duration,
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)


f1.lmer.stress1 <- lmer(
  f1.z ~
    (1|speaker) +
    (1|frame) +
    V1*duration + stress,
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)

f1.lmer.stress2 <- lmer(
  f1.z ~
    (1|speaker) +
    (1|frame) +
    V1*duration + V1*stress,
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)



anova(f1.lmer.base, f1.lmer.stress1, f1.lmer.stress2)



r2(f1.lmer.base)
r2(f1.lmer.stress1)
r2(f1.lmer.stress2)

# add random slope before extracting coefficients

f1.lmer.final <- lmer(
  f1.z ~
    (1+stress|speaker) +
    (1|frame) +
    V1*duration + V1*stress,
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)



```

```{r f1-emmeans}
emmeans(f1.lmer.final, pairwise ~ stress | V1)$contrasts

test(emtrends(f1.lmer.final, ~ V1, var = "duration"))
```


```{r ef-f1}
ef1 <- as.data.frame(effect("V1:duration", f1.lmer.final)) %>%
  mutate(V1 = factor(V1, levels = c('i', 'ɨ', 'u', 'e', 'a', 'o')))

ef2 <- as.data.frame(effect("V1:stress", f1.lmer.final)) %>%
  mutate(V1 = factor(V1, levels = c('i', 'ɨ', 'u', 'e', 'a', 'o')))

midpoint_rotated_ef1 <- midpoint_rotated %>%
  mutate(V1 = factor(V1, levels = c('i', 'ɨ', 'u', 'e', 'a', 'o')))

pd = position_dodge(0.5)

f1.dur.plot <- ef1 %>%
  ggplot() +
  aes(duration, fit) +
  #add data
  geom_point(data = midpoint_rotated_ef1, aes(duration, f1.z), alpha = 0.08) +
  geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.3) +
  geom_line() +
  #geom_line(aes(duration, -upper, color=stress), linetype=2)+
  #geom_line(aes(duration, -lower, color=stress), linetype=2)+
  #scale_color_grey()+
  facet_wrap( ~ V1) +
  scale_y_reverse("Normalised F1 (z-scores)") +
  scale_x_continuous('Vowel duration (ms)')


f1.stress.plot <- ef2 %>%
  ggplot() +
  aes(V1, fit, color = stress, linetype = stress) +
  geom_point(position = pd) +
  geom_errorbar(
    aes(ymin = lower, ymax = upper),
    position = pd,
    width = 0,
    size = 0.5
  ) +
  scale_x_discrete('Vowel')

f1.dur.plot + f1.stress.plot + plot_layout(ncol = 2, widths = c(2/3, 1/3))


ggsave(
  file = "./figures/Figure5.pdf",
  width = 7,
  height = 5,
  device = cairo_pdf
)
```

## F2

```{r f2-lmer}
f2.lmer.base <- lmer(
  f2.z ~
    (1|speaker) +
    (1|frame) +
    V1*duration,
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)


f2.lmer.stress1 <- lmer(
  f2.z ~
    (1|speaker) +
    (1|frame) +
    V1*duration + stress,
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)

f2.lmer.stress2 <- lmer(
  f2.z ~
    (1|speaker) +
    (1|frame) +
    V1*duration + V1*stress,
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)

anova(f2.lmer.base, f2.lmer.stress1, f2.lmer.stress2)


r2(f2.lmer.base)
r2(f2.lmer.stress1)
r2(f2.lmer.stress2)

# significant improvement after including stress, but not improvement in R2

f2.lmer.final <- lmer(
  f2.z ~
    (1+duration|speaker) +
    (1|frame) +
    V1*duration,
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)


```


```{r f2-emmeans}
test(emtrends(f2.lmer.final, ~ V1, var = "duration"))
```



```{r ef-f2}
ef2 <- as.data.frame(effect("V1:duration", f2.lmer.final)) %>%
  mutate(V1 = factor(V1, levels = c('i', 'u', 'ɨ', 'e', 'o', 'a')))

midpoint_rotated_ef2 <- midpoint_rotated %>%
  mutate(V1 = factor(V1, levels = c('i', 'u', 'ɨ', 'e', 'o', 'a')))


ef2 %>%
  ggplot() +
  aes(duration, fit) +
  #add data
  geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.3) +
  geom_line() +
  geom_point(data = midpoint_rotated_ef2, aes(duration, f2.z), alpha = 0.08) +
  #geom_line(aes(duration, -upper, color=stress), linetype=2)+
  #geom_line(aes(duration, -lower, color=stress), linetype=2)+
  #scale_color_grey()+
  facet_wrap( ~ V1, ncol = 3) +
  scale_y_reverse("Normalised F2 (z-scores)") +
  scale_x_continuous('Vowel duration (ms)')

ggsave(
  file = "./figures/Figure6.pdf",
  width = 3,
  height = 4,
  device = cairo_pdf
)
```



## Z1

```{r z1-lmer}
z1.lmer.base <- lmer(
  z1 ~
    (1|speaker) +
    (1|frame) +
    V1*duration,
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)

z1.lmer.stress1 <- lmer(
  z1 ~
    (1|speaker) +
    (1|frame) +
    V1*duration + stress,
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)

z1.lmer.stress2 <- lmer(
  z1 ~
    (1|speaker) +
    (1|frame) +
    V1*duration + V1*stress,
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)

anova(z1.lmer.base, z1.lmer.stress1, z1.lmer.stress2)

r2(z1.lmer.base)
r2(z1.lmer.stress1)
r2(z1.lmer.stress2)

# add random slope before extracting coefficients

z1.lmer.final <- lmer(
  z1 ~
    (1+duration|speaker) +
    (1|frame) +
    V1*duration,
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)
```


```{r z1-emmeans}
test(emtrends(z1.lmer.final, ~ V1, var = "duration"))
```



```{r ef-z1}
ef1 <- as.data.frame(effect("V1:duration", z1.lmer.final)) %>%
  mutate(V1 = factor(V1, levels = c('i', 'ɨ', 'u', 'e', 'a', 'o')))

midpoint_rotated_z1 <- midpoint_rotated %>%
  mutate(V1 = factor(V1, levels = c('i', 'ɨ', 'u', 'e', 'a', 'o')))

z1.dur.ef <- ef1 %>%
  ggplot() +
  aes(duration, fit) +
  #add data
  geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.3) +
  geom_line() +
  geom_point(data = midpoint_rotated_z1, aes(duration, z1), alpha = 0.5) +
  #geom_line(aes(duration, -upper, color=stress), linetype=2)+
  #geom_line(aes(duration, -lower, color=stress), linetype=2)+
  #scale_color_grey()+
  facet_wrap( ~ V1) +
  scale_y_reverse("z1.z") +
  scale_x_continuous('duration (ms)')

z1.dur.ef

ggsave(
  z1.dur.ef,
  file = "./figures/Figure7.pdf",
  width = 7,
  height = 5,
  device = cairo_pdf
)
```

## Z2

```{r z2-lmer}
z2.lmer.base <- lmer(
  z2 ~
    (1|speaker) +
    (1|frame) +
    V1*duration ,
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)

z2.lmer.stress1 <- lmer(
  z2 ~
    (1|speaker) +
    (1|frame) +
    V1*duration + stress,
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)

z2.lmer.stress2 <- lmer(
  z2 ~
    (1|speaker) +
    (1|frame) +
    V1*duration + V1*stress,
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)


anova(z2.lmer.base, z2.lmer.stress1, z2.lmer.stress2)

r2(z2.lmer.base)
r2(z2.lmer.stress1)
r2(z2.lmer.stress2)

z2.lmer.final <- lmer(
  z2 ~
    (1+duration|speaker) +
    (1|frame) +
    V1*duration ,
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)
```


```{r z2-emmeans}
test(emtrends(z2.lmer.final, ~ V1, var = "duration"))
```


```{r ef-z2}
ef1 <- as.data.frame(effect("V1:duration", z2.lmer.final)) %>%
  mutate(V1 = factor(V1, levels = c('i', 'u', 'e', 'o', 'ɨ', 'a')))

midpoint_rotated_z2 <- midpoint_rotated %>%
  mutate(V1 = factor(V1, levels = c('i', 'u', 'e', 'o', 'ɨ', 'a')))

z2.dur.plot <- ef1 %>%
  ggplot() +
  aes(duration, fit) +
  #add data
  geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.3) +
  geom_line() +
  geom_point(data = midpoint_rotated_z2, aes(duration, f2.z), alpha = 0.5) +
  #geom_line(aes(duration, -upper, color=stress), linetype=2)+
  #geom_line(aes(duration, -lower, color=stress), linetype=2)+
  #scale_color_grey()+
  facet_wrap( ~ V1, ncol = 2) +
  scale_y_reverse("z2") +
  scale_x_continuous('duration (ms)')

z2.dur.plot

ggsave(
  z2.dur.plot,
  file = "./figures/Figure8.pdf",
  width = 4,
  height = 5,
  device = cairo_pdf
)
```

# Model summaries

## Duration

```{r dur-lmer-tab}
tab_model(dur.lmer.full, digits = 4, digits.p = 5, digits.re = 4, p.val = "kr", show.df = TRUE)
```

## F1

```{r f1-lmer-tab}
tab_model(f1.lmer.final, digits = 4, digits.p = 5, digits.re = 4, p.val = "kr", show.df = TRUE)
```

## F2

```{r f2-lmer-tab}
tab_model(f2.lmer.final, digits = 4, digits.p = 5, digits.re = 4, p.val = "kr", show.df = TRUE)
```

## Z1

```{r z1-lmer-tab}
tab_model(z1.lmer.final, digits = 4, digits.p = 5, digits.re = 4, p.val = "kr", show.df = TRUE)
```

## Z2

```{r z2-lmer-tab}
tab_model(z2.lmer.final, digits = 4, digits.p = 5, digits.re = 4, p.val = "kr", show.df = TRUE)
```

# Further exploratory analyses

## F0

```{r f0-lmer}
f0.lmer1 <- lmer(
  f0.z ~
    (1|speaker) +
    (1|frame) +
    V1 + duration + stress,
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)

f0.lmer2 <- lmer(
  f0.z ~
    (1|speaker) +
    (1|frame) +
    V1 * duration + stress,
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)

f0.lmer3 <- lmer(
  f0.z ~
    (1|speaker) +
    (1|frame) +
    V1 * duration + V1 * stress,
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)

anova(f0.lmer1, f0.lmer2, f0.lmer3)


# contrast code vowels

midpoint_rotated$V1 = factor(midpoint_rotated$V1)
contrasts(midpoint_rotated$V1) <- "contr.sum"

f0.lmer.final <- lmer(
  f0.z ~
    (1|speaker) +
    (1|frame) +
    V1 * duration + stress,
  data = midpoint_rotated,
  control = lmerControl(
    optimizer = "optimx",
    calc.derivs = FALSE,
    optCtrl = list(method = "bobyqa")
  )
)
```


```{r f0-lmer-tab}
tab_model(f0.lmer.final)
```


# Session info


```{r sess-info}
devtools::session_info()
```

